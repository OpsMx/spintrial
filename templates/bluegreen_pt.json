{"id":"opsmx-001-BlueGreen-2019","metadata":{"description":"Pipeline Template for BlueGreen RollBack Simple Pet Dog Application Deployment","name":"BlueGreenRollBack","owner":"trialspin@opsmx.com","scopes":["global"]},"pipeline":{"keepWaitingPipelines":false,"lastModifiedBy":"${ trigger[user] }","limitConcurrent":true,"parameterConfig":[],"stages":[{"continuePipeline":false,"failPipeline":true,"job":"Petapp","master":"opsmx-jenkins-master","name":"Build","parameters":{},"propertyFile":"file.properties","refId":"1","requisiteStageRefIds":[],"type":"jenkins"},{"account":"dev-k8s-v2","cloudProvider":"kubernetes","manifestArtifactAccount":"docker-registry","manifests":[{"apiVersion":"extensions/v1beta1","kind":"ReplicaSet","metadata":{"name":"${ trigger['user'] }","namespace":"${ trigger[user] }"},"spec":{"replicas":1,"selector":{"matchLabels":{"app":"${#stage(\"Build\")[\"context\"][\"Buildnumber\"]}"}},"template":{"metadata":{"labels":{"app":"${#stage(\"Build\")[\"context\"][\"Buildnumber\"]}"}},"spec":{"containers":[{"image":"docker.io/opsmx11/restapp:${#stage(\"Build\")[\"context\"][\"Buildnumber\"]}","imagePullPolicy":"Always","name":"restapp","ports":[{"containerPort":8080,"name":"http","protocol":"TCP"},{"containerPort":9090,"name":"prometheus","protocol":"TCP"}]}]}}}},{"apiVersion":"v1","kind":"Service","metadata":{"name":"${ trigger['user'] }","namespace":"${ trigger[user] }"},"spec":{"ports":[{"name":"canary","port":8080,"protocol":"TCP"},{"name":"reports","port":9090,"protocol":"TCP"}],"selector":{"app":"${#stage(\"Build\")[\"context\"][\"Buildnumber\"]}"},"type":"NodePort"}}],"moniker":{"app":"${ trigger[user] }"},"name":"Staging_Deploy","refId":"2","relationships":{"loadBalancers":[],"securityGroups":[]},"requisiteStageRefIds":["1"],"skipExpressionEvaluation":false,"source":"text","trafficManagement":{"enabled":false,"options":{"enableTraffic":false,"namespace":"${ trigger[user] }"}},"type":"deployManifest"},{"continuePipeline":false,"failPipeline":true,"job":"PetLoad","master":"opsmx-jenkins-master","name":"Run Test Suite1","parameters":{"port":"32650"},"refId":"3","requisiteStageRefIds":["2"],"type":"jenkins"},{"failPipeline":true,"judgmentInputs":[{"value":"Success"},{"value":"Failure"}],"name":"Verify Test","notifications":[],"propagateAuthenticationContext":true,"refId":"4","requisiteStageRefIds":["3"],"type":"manualJudgment"},{"application":"${ trigger[user] }","failPipeline":true,"name":"Prod-Deploy","pipeline":"${#pipelineId(\"Promote to Prod(Blue-Green)\")}","pipelineParameters":{"version":"${#stage(\"Build\")[\"context\"][\"Buildnumber\"]}"},"refId":"5","requisiteStageRefIds":["4"],"type":"pipeline","waitForCompletion":true}],"triggers":[]},"protect":false,"schema":"v2","variables":[]}
